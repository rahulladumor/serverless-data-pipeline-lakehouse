name: CI

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

jobs:
  validate:
    name: Validate Project
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Check required files
        run: |
          echo "üìã Checking project structure..."
          
          # Required files
          for file in README.md LICENSE CONTRIBUTING.md SECURITY.md; do
            if [ -f "$file" ]; then
              echo "‚úÖ $file"
            else
              echo "‚ö†Ô∏è $file missing"
            fi
          done

      - name: Check documentation
        run: |
          echo "üìö Checking documentation..."
          
          for file in docs/cost.md docs/security.md docs/runbook.md docs/troubleshooting.md; do
            if [ -f "$file" ]; then
              echo "‚úÖ $file"
            else
              echo "‚ö†Ô∏è $file missing"
            fi
          done

      - name: Validate diagrams
        run: |
          echo "üìä Checking Mermaid diagrams..."
          
          for file in diagrams/architecture.mmd diagrams/sequence.mmd diagrams/dataflow.mmd; do
            if [ -f "$file" ]; then
              # Check first line for valid mermaid syntax
              first=$(head -1 "$file")
              if echo "$first" | grep -qE "^(graph|sequenceDiagram|flowchart|classDiagram|stateDiagram|erDiagram)"; then
                echo "‚úÖ $file - valid syntax"
              else
                echo "‚ö†Ô∏è $file - check syntax (first line: $first)"
              fi
            else
              echo "‚ö†Ô∏è $file missing"
            fi
          done

      - name: Check IaC files
        run: |
          echo "üèóÔ∏è Checking Infrastructure files..."
          
          if [ -f "cdk.json" ]; then
            echo "‚úÖ CDK project detected"
            cat cdk.json | head -5
          elif [ -f "cdktf.json" ]; then
            echo "‚úÖ CDKTF project detected"
          elif [ -f "main.tf" ]; then
            echo "‚úÖ Terraform project detected"
          elif [ -d "terraform" ]; then
            echo "‚úÖ Terraform directory detected"
          else
            echo "‚ÑπÔ∏è No IaC configuration found in root"
          fi
